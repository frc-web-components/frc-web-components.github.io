var j=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var y=(s,t,e)=>(j(s,t,"read from private field"),e?e.call(s):t.get(s)),L=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)};import{e as a}from"./query-assigned-elements-bd4ea1f7.js";import{i as O}from"./query-99a7b366.js";import{s as W,r as H,$ as A}from"./lit-element-ac510585.js";import{b as I,c as u,t as k}from"./units-530c171f.js";import{l as F}from"./if-defined-a8bd05d9.js";const X=[{game:"Charged Up",image:"/field-images/2023-field.jpg",corners:{topLeft:[46,36],bottomRight:[1088,544]},size:[54.27083,26.2916],unit:"foot"},{game:"Rapid React",image:"/field-images/2022-field.jpg",corners:{topLeft:[74,50],bottomRight:[1774,900]},size:[54,27],unit:"foot"},{game:"Infinite Recharge",image:"/field-images/2020-field.jpg",corners:{topLeft:[96,25],bottomRight:[1040,514]},size:[52.4375,26.9375],unit:"foot"},{game:"Destination: Deep Space",image:"/field-images/2019-field.jpg",corners:{topLeft:[217,40],bottomRight:[1372,615]},size:[54,27],unit:"foot"},{game:"FIRST Power Up",image:"/field-images/2018-field.jpg",corners:{topLeft:[125,20],bottomRight:[827,370]},size:[54,27],unit:"feet"},{game:"Barrel Racing Path",image:"/field-images/2021-barrel.png",corners:{topLeft:[20,20],bottomRight:[780,400]},size:[30,15],unit:"feet"},{game:"Bounce Path",image:"/field-images/2021-bounce.png",corners:{topLeft:[20,20],bottomRight:[780,400]},size:[30,15],unit:"feet"},{game:"Galactic Search A",image:"/field-images/2021-galacticsearcha.png",corners:{topLeft:[20,20],bottomRight:[780,400]},size:[30,15],unit:"feet"},{game:"Galactic Search B",image:"/field-images/2021-galacticsearchb.png",corners:{topLeft:[20,20],bottomRight:[780,400]},size:[30,15],unit:"feet"},{game:"Slalom Path",image:"/field-images/2021-slalom.png",corners:{topLeft:[20,20],bottomRight:[780,400]},size:[30,15],unit:"feet"}],x=X;var P,C;class ${constructor(){L(this,P,{});L(this,C,new Map)}getImage(t){if(typeof y(this,P)[t]>"u"){const e=new Image,i={src:t,width:0,height:0,loaded:!1,image:e};e.onload=()=>{i.loaded=!0,i.width=e.width,i.height=e.height,[...y(this,C).values()].forEach(o=>{console.log("on load",o),o(t)})},y(this,P)[t]=i,e.src=t}return y(this,P)[t]}static getBoundingBoxDims(t,e){const i=Math.abs(t.width*Math.cos(e))+Math.abs(t.height*Math.sin(e)),o=Math.abs(t.width*Math.sin(e))+Math.abs(t.height*Math.cos(e));return{width:i,height:o}}static fitImageInsideBox(t,e){return e.width/t.width*t.height<=e.height?{width:e.width,height:e.width/t.width*t.height}:{width:e.height/t.height*t.width,height:e.height}}onImageLoad(t){const e=Symbol("image");return y(this,C).set(e,t),()=>{y(this,C).delete(e)}}}P=new WeakMap,C=new WeakMap;var Y=Object.defineProperty,q=Object.getOwnPropertyDescriptor,w=(s,t,e,i)=>{for(var o=i>1?void 0:i?q(t,e):t,r=s.length-1,h;r>=0;r--)(h=s[r])&&(o=(i?h(t,e,o):h(o))||o);return i&&o&&Y(t,e,o),o};class m extends W{constructor(){super(...arguments),this.unit="inherit",this.image="",this.color="#0000ff",this.opacity=1,this.pose=[0,0,0],this.width=.6,this.length=.9}draw({canvas:t,unit:e,xToPx:i,yToPx:o,lengthToPx:r,flipSide:h}){const n=this.unit==="inherit"?e:this.unit,[f,g,c]=this.pose;t.globalAlpha=Math.max(0,Math.min(1,this.opacity)),t.fillStyle="#222",t.strokeStyle=this.color,t.lineWidth=r(3,"in"),t.translate(i(f,n),o(g,n)),t.rotate(-c+(h?Math.PI:0)),t.roundRect(-r(this.length/2,n),-r(this.width/2,n),r(this.length,n),r(this.width,n),1),t.fill(),t.stroke(),t.beginPath(),t.fillStyle="white",t.strokeStyle="white",t.lineWidth=r(2,"in"),t.moveTo(-r(this.length*.3,n),0),t.lineTo(r(this.length*.3,n),0),t.moveTo(r(this.length*.1,n),-r(this.width*.25,n)),t.lineTo(r(this.length*.3,n),0),t.lineTo(r(this.length*.1,n),r(this.width*.25,n)),t.stroke()}}w([a({type:String})],m.prototype,"unit",2);w([a({type:String})],m.prototype,"image",2);w([a({type:String})],m.prototype,"color",2);w([a({type:Number})],m.prototype,"opacity",2);w([a({type:Array})],m.prototype,"pose",2);w([a({type:Number})],m.prototype,"width",2);w([a({type:Number})],m.prototype,"length",2);customElements.get("frc-field-robot")||customElements.define("frc-field-robot",m);var J=Object.defineProperty,K=Object.getOwnPropertyDescriptor,d=(s,t,e,i)=>{for(var o=i>1?void 0:i?K(t,e):t,r=s.length-1,h;r>=0;r--)(h=s[r])&&(o=(i?h(t,e,o):h(o))||o);return i&&o&&J(t,e,o),o},Q=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)},v=(s,t,e)=>(Q(s,t,"read from private field"),e?e.call(s):t.get(s)),Z=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},b;function tt(s){return s*Math.PI/180}let l=class extends W{constructor(){super(...arguments),this.game=x[0].game,this.cropTop=null,this.cropBottom=null,this.cropLeft=null,this.cropRight=null,this.cropType="percent",this.unit=I,this.rotation=0,this.showGrid=!1,this.gridSize=1,this.flipSide=!1,Z(this,b,new $)}getConfig(){return x.find(({game:e})=>e===this.game)??x[0]}getCanvasCtx(){return this.canvas.getContext("2d")}getCropPercent(){if(this.cropType==="percent"){const D=this.cropLeft??0,U=this.cropTop??0,E=this.cropRight??1,N=this.cropBottom??1;return{x1:D,y1:U,x2:E,y2:N}}const{corners:t,image:e,unit:i,size:o}=this.getConfig(),{loaded:r,width:h,height:n}=v(this,b).getImage(e);if(!r)return{x1:0,y1:0,x2:1,y2:1};const f=[this.cropLeft??0,this.cropTop??0],g=[this.cropRight??u(o[0],i,this.unit),this.cropBottom??u(o[1],i,this.unit)],c=t.topLeft[0]/h,p=t.topLeft[1]/n,z=t.bottomRight[0]/h,S=t.bottomRight[1]/n,R=z-c,_=S-p;return{x1:c+R*u(f[0],this.unit,i)/o[0],y1:p+_*u(f[1],this.unit,i)/o[1],x2:c+R*u(g[0],this.unit,i)/o[0],y2:p+_*u(g[1],this.unit,i)/o[1]}}getFieldRectPx(){const{corners:t,image:e}=this.getConfig(),{loaded:i,width:o,height:r}=v(this,b).getImage(e);if(!i)return{x:0,y:0,width:0,height:0};const h=t.topLeft[0]/o,n=t.topLeft[1]/r,f=t.bottomRight[0]/o,g=t.bottomRight[1]/r,c=this.getCropPercent(),p=c.x2-c.x1,z=c.y2-c.y1,S=this.canvas.width/p,R=this.canvas.height/z;return{x:(h-c.x1)*S,y:(n-c.y1)*R,width:(f-h)*S,height:(g-n)*R}}xToPx(t,e=this.unit){const i=this.getFieldRectPx(),{size:o,unit:r}=this.getConfig();if(i.width===0)return 0;const h=i.width/o[0],n=u(t,e,r);return this.flipSide?i.x+i.width-n*h:i.x+n*h}yToPx(t,e=this.unit){const i=this.getFieldRectPx(),{size:o,unit:r}=this.getConfig();if(i.height===0)return 0;const h=i.height/o[1],n=u(t,e,r);return this.flipSide?i.y+n*h:i.y+i.height-n*h}lengthToPx(t,e=this.unit){const i=this.getFieldRectPx(),{size:o,unit:r}=this.getConfig();if(i.width===0)return 0;const h=i.width/o[0];return u(t,e,r)*h}setContainerSize(){const t=this.getBoundingClientRect(),e=this.getConfig().image,i=v(this,b).getImage(e),{loaded:o}=i;if(!o)return;const r=this.getCropPercent(),h={width:(r.x2-r.x1)*i.width,height:(r.y2-r.y1)*i.height},n=$.getBoundingBoxDims(h,tt(this.rotation)),g=$.fitImageInsideBox(n,{width:t.width,height:t.height}).width/n.width;this.container.style.width=`${h.width*g}px`,this.container.style.height=`${h.height*g}px`}drawImage(){const t=this.getCanvasCtx(),e=this.getConfig().image,{loaded:i,image:o,width:r,height:h}=v(this,b).getImage(e);if(!i)return;const{clientWidth:n,clientHeight:f}=this.canvas,g=n*window.devicePixelRatio,c=f*window.devicePixelRatio;this.canvas.width=g,this.canvas.height=c;const p=this.getCropPercent();t.drawImage(o,p.x1*r,p.y1*h,(p.x2-p.x1)*r,(p.y2-p.y1)*h,0,0,g,c)}drawFieldRect(){const t=this.getCanvasCtx(),{x:e,y:i,width:o,height:r}=this.getFieldRectPx();t.rect(e,i,o,r),t.lineWidth=2,t.strokeStyle="yellow",t.stroke()}drawGrid(){const t=this.getCanvasCtx(),{image:e,size:i}=this.getConfig(),{loaded:o}=v(this,b).getImage(e);if(!(!o||!this.showGrid||this.gridSize<=0)){t.lineWidth=1,t.strokeStyle="gray";for(let r=0;r<=i[0];r+=this.gridSize)t.beginPath(),t.moveTo(this.xToPx(r),this.yToPx(0)),t.lineTo(this.xToPx(r),this.yToPx(i[1])),t.stroke();for(let r=0;r<=i[1];r+=this.gridSize)t.beginPath(),t.moveTo(this.xToPx(0),this.yToPx(r)),t.lineTo(this.xToPx(i[0]),this.yToPx(r)),t.stroke()}}drawChildren(){const t=this.getCanvasCtx();t.save(),t.beginPath();const e={canvas:this.getCanvasCtx(),getFieldRectPx:()=>this.getFieldRectPx(),unit:this.unit,xToPx:(i,o)=>this.xToPx(i,o),yToPx:(i,o)=>this.yToPx(i,o),lengthToPx:(i,o)=>this.lengthToPx(i,o),flipSide:this.flipSide};[...this.children].forEach(i=>{var r;const o=i;(r=o.draw)==null||r.call(o,e)}),t.restore()}drawField(){this.setContainerSize(),this.drawImage(),this.drawFieldRect(),this.drawGrid(),this.drawChildren(),window.requestAnimationFrame(()=>{this.drawField()})}firstUpdated(){this.drawField()}render(){return A`
      <div class="container" style="transform: rotate(${-this.rotation}deg)">
        <canvas></canvas>
      </div>
    `}};b=new WeakMap;l.styles=H`
    :host {
      display: inline-flex;
      width: 500px;
      height: 300px;
      justify-content: center;
      align-items: center;
    }

    .container {
    }

    canvas {
      width: 100%;
      height: 100%;
    }
  `;d([a({type:String})],l.prototype,"game",2);d([a({type:Number,attribute:"crop-top"})],l.prototype,"cropTop",2);d([a({type:Number,attribute:"crop-bottom"})],l.prototype,"cropBottom",2);d([a({type:Number,attribute:"crop-left"})],l.prototype,"cropLeft",2);d([a({type:Number,attribute:"crop-right"})],l.prototype,"cropRight",2);d([a({type:String,attribute:"crop-type"})],l.prototype,"cropType",2);d([a({type:String})],l.prototype,"unit",2);d([a({type:Number})],l.prototype,"rotation",2);d([a({type:Boolean,attribute:"show-grid"})],l.prototype,"showGrid",2);d([a({type:Number,attribute:"grid-size"})],l.prototype,"gridSize",2);d([a({type:Boolean,attribute:"flip-side"})],l.prototype,"flipSide",2);d([O("canvas",!0)],l.prototype,"canvas",2);d([O(".container",!0)],l.prototype,"container",2);customElements.get("frc-field")||customElements.define("frc-field",l);const G={game:x[0].game,cropType:"percent",unit:I,rotation:0,showGrid:!1,gridSize:1,flipSide:!1,robotColor:"blue",robotOpacity:1,robotX:0,robotY:0,robotAngle:0,robotWidth:.6,robotLength:.9},lt={title:"FRC/Field",tags:["autodocs"],component:"frc-field",args:G,argTypes:{game:{table:{category:"Field",defaultValue:{summary:x[0].game}},options:x.map(({game:s})=>s),control:"select"},cropType:{control:"radio",options:["percent","distance"],table:{category:"Field",defaultValue:"percent"}},cropTop:{control:"number",table:{category:"Field"}},cropBottom:{control:"number",table:{category:"Field"}},cropLeft:{control:"number",table:{category:"Field"}},cropRight:{control:"number",table:{category:"Field"}},unit:{table:{category:"Field",defaultValue:I},options:Object.keys(k),control:"select"},rotation:{table:{category:"Field",defaultValue:{summary:0}}},showGrid:{table:{category:"Field",defaultValue:{summary:!1}}},gridSize:{table:{category:"Field",defaultValue:{summary:1}}},flipSide:{table:{category:"Field",defaultValue:{summary:!1}}},robotColor:{control:"color",table:{category:"Robot",defaultValue:{summary:"blue"}}},robotOpacity:{table:{category:"Robot",defaultValue:{summary:1}}},robotX:{table:{category:"Robot",defaultValue:{summary:0}}},robotY:{table:{category:"Robot",defaultValue:{summary:0}}},robotAngle:{table:{category:"Robot",defaultValue:{summary:0}}},robotWidth:{table:{category:"Robot",defaultValue:{summary:.6}}},robotLength:{table:{category:"Robot",defaultValue:{summary:.9}}}}};function et(s={}){return{args:{...G,...s},parameters:{canvas:{sourceState:"shown"}},render:e=>A`
      <frc-field
        game=${e.game}
        crop-type=${e.cropType}
        crop-top=${F(e.cropTop??void 0)}
        crop-bottom=${F(e.cropBottom??void 0)}
        crop-left=${F(e.cropLeft??void 0)}
        crop-right=${F(e.cropRight??void 0)}
        unit=${e.unit}
        rotation=${e.rotation}
        ?show-grid=${e.showGrid}
        grid-size=${e.gridSize}
        ?flip-side=${e.flipSide}
      >
        <frc-field-robot
          color=${e.robotColor}
          opacity=${e.robotOpacity}
          pose="[${[e.robotX,e.robotY,e.robotAngle]}]"
          width=${e.robotWidth}
          length=${e.robotLength}
        ></frc-field-robot>
      </frc-field>
    `}}const T=et();var B,V,M;T.parameters={...T.parameters,docs:{...(B=T.parameters)==null?void 0:B.docs,source:{originalSource:"createFieldStory()",...(M=(V=T.parameters)==null?void 0:V.docs)==null?void 0:M.source}}};const dt=["Field"];export{T as Field,dt as __namedExportsOrder,lt as default};
//# sourceMappingURL=Field.stories-86be5fbd.js.map
