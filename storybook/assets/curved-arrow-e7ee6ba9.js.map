{"version":3,"file":"curved-arrow-e7ee6ba9.js","sources":["../../src/elements/base/drivebases/curved-arrow.ts"],"sourcesContent":["/**\n * Copyright (c) 2017-2018 FIRST\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of FIRST nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY FIRST AND CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY NONINFRINGEMENT AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL FIRST OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/**\n * A utility class for generating curved arrows. The generated arrows follow a <i>circular</i>, rather than\n * <i>elliptical</i>, path. The heads of the arrows are always the same isosceles triangle with the length of the base\n * equalling the height of the triangle; this works out to be (approximately) a 63-63-54 triangle.\n */\n\ntype Point = { x: number; y: number };\n\nfunction toDegrees(radians: number) {\n  return (radians * 180) / Math.PI;\n}\n\nfunction line(x1: number, y1: number, x2: number, y2: number) {\n  return `<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\" />`;\n}\n\nfunction triangle(point1: Point, point2: Point, point3: Point) {\n  return `<polygon \n            points=\"${point1.x},${point1.y} ${point2.x},${point2.y} ${point3.x},${point3.y}\" />`;\n}\n\n// https://stackoverflow.com/questions/5736398/how-to-calculate-the-svg-path-for-an-arc-of-a-circle\nfunction polarToCartesian(\n  centerX: number,\n  centerY: number,\n  radius: number,\n  angleInDegrees: number\n) {\n  const angleInRadians = (angleInDegrees * Math.PI) / 180.0;\n\n  return {\n    x: centerX + radius * Math.cos(angleInRadians),\n    y: centerY - radius * Math.sin(angleInRadians),\n  };\n}\n\nfunction describeArc(\n  x: number,\n  y: number,\n  radius: number,\n  startAngle: number,\n  endAngle: number\n) {\n  const start = polarToCartesian(x, y, radius, endAngle);\n  const end = polarToCartesian(x, y, radius, startAngle);\n\n  const largeArcFlag = endAngle - startAngle <= 180 ? '0' : '1';\n  const sweepFlag = endAngle > startAngle ? 1 : 0;\n\n  const d = [\n    'M',\n    start.x,\n    start.y,\n    'A',\n    radius,\n    radius,\n    0,\n    largeArcFlag,\n    sweepFlag,\n    end.x,\n    end.y,\n  ].join(' ');\n\n  return d;\n}\n\nfunction arc(\n  x: number,\n  y: number,\n  radius: number,\n  startAngle: number,\n  endAngle: number\n) {\n  return `<path d=\"${describeArc(x, y, radius, startAngle, endAngle)}\"/>`;\n}\n\n/**\n * Generates the head of a straight arrow.\n */\nexport function straightHead(\n  startAngle: number,\n  size: number,\n  xOffset: number,\n  bodyLength: number\n): string {\n  const base = size / 2;\n\n  // Unit vector to the end of the shaft\n  const ux = Math.cos(startAngle);\n  const uy = Math.sin(startAngle);\n\n  // Unit vector to the center of the base of the head\n  const bx = Math.cos(startAngle + Math.PI / 2) * base; // ==  Math.sin(startAngle)\n  const by = Math.sin(startAngle + Math.PI / 2) * base; // == -Math.cos(startAngle)\n\n  const basePoint1 = {\n    x: ux * bodyLength - bx + xOffset,\n    y: uy * bodyLength - by,\n  };\n\n  const basePoint2 = {\n    x: ux * bodyLength + bx + xOffset,\n    y: uy * bodyLength + by,\n  };\n\n  const tip = {\n    x: ux * (size + bodyLength) + xOffset,\n    y: uy * (size + bodyLength),\n  };\n\n  return triangle(basePoint1, basePoint2, tip);\n}\n\n/**\n * Creates a straight arrow, which is just a curved arrow with an infinite radius.\n *\n * @param length   the length of the arrow\n * @param angle    the angle of the arrow, in radians\n * @param xOffset  how much to offset the arrow along the X-axis\n * @param headSize the length of the head of the arrow\n */\nexport function createStraight(\n  length: number,\n  angle: number,\n  xOffset: number,\n  headSize: number\n): string {\n  const x = Math.cos(angle) * length;\n  const y = Math.sin(angle) * length;\n  const body = line(xOffset, 0, x + xOffset, y);\n  const head = straightHead(angle, headSize, xOffset, length);\n  return body + head;\n}\n\n/**\n * Generates the body arc of the arrow.\n *\n * @param startAngle the starting angle of the arc, in radians\n * @param radius     the radius of the arc\n * @param length     the length of the arc, in the same unit as {@code radius}\n * @param xOffset    how much to offset the arc along the X-axis\n */\nexport function makeBody(\n  startAngle: number,\n  radius: number,\n  length: number,\n  xOffset: number\n) {\n  const angRad = length / radius; // Isn't math nice?\n  const angle = toDegrees(angRad);\n  return arc(\n    xOffset,\n    0,\n    radius,\n    toDegrees(startAngle),\n    toDegrees(startAngle) - angle\n  );\n}\n\n/**\n * Generates the head of a curved arrow.\n *\n * @param startAngle the starting angle of the arc, in radians\n * @param size       the length of the arrow head\n * @param arcRadius  the radius of the arc of the arrow\n * @param arcLength  the length of the arc of the arrow\n */\nexport function curvedHead(\n  startAngle: number,\n  size: number,\n  arcRadius: number,\n  xOffset: number,\n  arcLength: number\n) {\n  // Half the length of the triangle\n  const base = size / 2;\n\n  // Angle to the base of the arrow\n  const angleToBase = arcLength / arcRadius - startAngle;\n\n  // Radius to the tip of the arrow. Simple Pythagorean theorem\n  const tipRadius = Math.sqrt(size * size + arcRadius * arcRadius);\n\n  // Angle to the tip of the arrow\n  // If the length is negative, the tip is closer to the start of the arc and therefore needs to be\n  // (arcLength - size) / arcRadius - startAngle\n  // If the length is positive, the tip is further from the start of the arc is is therefore\n  // (arcLength + size) / arcRadius - startAngle\n  // These are combined into a single calculating by multiplying `size` by the sign of the arc length\n  const angleToTip =\n    (arcLength + size * Math.sign(arcLength)) / arcRadius - startAngle;\n\n  const ux = Math.cos(angleToBase); // unit X in (-1, 1)\n  const uy = Math.sin(angleToBase); // unit Y in (-1, 1)\n\n  // Note there's no \"top\" or \"bottom\" point, since it depends on the sign of uy\n  const basePoint1 = {\n    x: (arcRadius + base) * ux + xOffset,\n    y: (arcRadius + base) * uy,\n  };\n\n  const basePoint2 = {\n    x: (arcRadius - base) * ux + xOffset,\n    y: (arcRadius - base) * uy,\n  };\n\n  const tipPoint = {\n    x: tipRadius * Math.cos(angleToTip) + xOffset,\n    y: tipRadius * Math.sin(angleToTip),\n  };\n\n  return triangle(basePoint1, tipPoint, basePoint2);\n}\n\n/**\n * Creates a new curved arrow.\n *\n * @param startAngle the starting angle of the arc, in radians\n * @param radius     the radius of the arrow. Must be non-negative.\n * @param length     the length of the arrow, in the same units as {@code radius}\n * @param xOffset    how much to offset the arc along the X-axis\n * @param headSize   the length of the head of the arrow\n *\n * @return a curved arrow shape\n *\n * @throws IllegalArgumentException if {@code radius} or {@code headSize} are negative\n */\nexport function create(\n  startAngle: number,\n  radius: number,\n  length: number,\n  xOffset: number,\n  headSize: number\n) {\n  if (radius < 0) {\n    throw new Error(`Radius cannot be negative. Given: ${radius}`);\n  }\n  if (headSize < 0) {\n    throw new Error(\n      `The size of the arrowhead cannot be negative. Given: ${headSize}`\n    );\n  }\n  if (radius === Infinity) {\n    // infinite radius = straight\n    return createStraight(length, startAngle, xOffset, headSize);\n  }\n\n  return (\n    makeBody(startAngle, radius, length, xOffset) +\n    curvedHead(startAngle, headSize, radius, xOffset, length)\n  );\n}\n\n/**\n * Creates a new curved arrow. This is equivalent to calling\n * {@link #create create(startAngle, radius, radius * sweepAngle, xOffset, headSize)}.\n *\n * @param startAngle the starting angle of the arc, in radians\n * @param radius     the radius of the arc\n * @param sweepAngle the sweep of the arc, in radians\n * @param xOffset    how much to offset the arc along the X-axis\n * @param headSize   the length of the head of the arrow\n *\n * @throws IllegalArgumentException if {@code radius} or {@code headSize} are negative\n */\nexport function createPolar(\n  startAngle: number,\n  radius: number,\n  sweepAngle: number,\n  xOffset: number,\n  headSize: number\n) {\n  return create(startAngle, radius, radius * sweepAngle, xOffset, headSize);\n}\n"],"names":["toDegrees","radians","line","x1","y1","x2","y2","triangle","point1","point2","point3","polarToCartesian","centerX","centerY","radius","angleInDegrees","angleInRadians","describeArc","x","y","startAngle","endAngle","start","end","largeArcFlag","sweepFlag","arc","straightHead","size","xOffset","bodyLength","base","ux","uy","bx","by","basePoint1","basePoint2","tip","createStraight","length","angle","headSize","body","head","makeBody","angRad","curvedHead","arcRadius","arcLength","angleToBase","tipRadius","angleToTip","tipPoint","create","createPolar","sweepAngle"],"mappings":"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"}