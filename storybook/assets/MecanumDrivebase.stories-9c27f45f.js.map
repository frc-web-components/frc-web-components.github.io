{"version":3,"file":"MecanumDrivebase.stories-9c27f45f.js","sources":["../../src/elements/base/drivebases/mecanum.ts"],"sourcesContent":["import { html, css, LitElement } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport * as CurvedArrow from './curved-arrow';\nimport '../base-elements/bar';\nimport '../base-elements/table-axis';\n\n/**\n * Copyright (c) 2017-2018 FIRST\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of FIRST nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY FIRST AND CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY NONINFRINGEMENT AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL FIRST OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nfunction generateX(width: number) {\n  const halfW = width / 2;\n  const lineA = `\n    <line \n      x1=\"${-halfW}\"\n      y1=\"${-halfW}\"\n      x2=\"${halfW}\"\n      y2=\"${halfW}\"\n    />\n  `;\n\n  const lineB = `\n    <line \n      x1=\"${-halfW}\"\n      y1=\"${halfW}\"\n      x2=\"${halfW}\"\n      y2=\"${-halfW}\"\n    />\n  `;\n\n  return `<g class=\"x\">${lineA} ${lineB}</g>`;\n}\n\nfunction clamp(value: number) {\n  return Math.min(1, Math.max(value, -1));\n}\n\nfunction getForegroundStyle(value: number) {\n  const min = -1;\n  const max = 1;\n  const val = clamp(value);\n\n  if (val > 0) {\n    return `\n      height: ${(Math.abs(val) / (max - min)) * 100}%;\n      top: auto;\n      bottom: 50%;\n    `;\n  }\n  return `\n    height: ${(Math.abs(val) / (max - min)) * 100}%;\n    top: 50%;\n    bottom: auto;\n  `;\n}\n\nexport default class MecanumDrivebase extends LitElement {\n  @property({ type: Number, attribute: 'front-left-motor-speed' })\n  frontLeftMotorSpeed = 0;\n  @property({ type: Number, attribute: 'front-right-motor-speed' })\n  frontRightMotorSpeed = 0;\n  @property({ type: Number, attribute: 'rear-left-motor-speed' })\n  rearLeftMotorSpeed = 0;\n  @property({ type: Number, attribute: 'rear-right-motor-speed' })\n  rearRightMotorSpeed = 0;\n\n  static styles = css`\n    :host {\n      display: inline-block;\n      width: 400px;\n      height: 300px;\n      padding: 0 10px;\n      font-family: sans-serif;\n    }\n\n    .diff-drive-container {\n      height: 100%;\n      width: 100%;\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      justify-content: center;\n    }\n\n    svg {\n      overflow: overlay;\n      flex: 1;\n      height: 100%;\n    }\n\n    svg .x {\n      stroke: rgb(50, 50, 255);\n      stroke-width: 2;\n    }\n\n    svg .arrow line,\n    svg .arrow path {\n      stroke: rgb(50, 50, 255);\n      stroke-width: 2;\n      fill: none;\n    }\n\n    svg .arrow polygon {\n      stroke: rgb(50, 50, 255);\n      fill: rgb(50, 50, 255);\n    }\n\n    svg .drivetrain {\n      fill: none;\n      stroke: var(--frc-mecanum-drivebase-drivetrain-color, #000);\n    }\n\n    .bar {\n      position: relative;\n      height: calc(100% - 30px);\n      width: 20px;\n      border-radius: 3px;\n      margin: 15px 0;\n      background: var(--frc-bar-background, #ddd);\n    }\n\n    .speed-pair {\n      height: 100%;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-around;\n    }\n\n    .speed {\n      display: flex;\n      height: 48%;\n      flex-direction: row;\n      align-items: center;\n      margin-left: 30px;\n    }\n\n    frc-table-axis {\n      width: 10px;\n      height: calc(100% - 35px);\n    }\n\n    .foreground {\n      position: absolute;\n      top: 0;\n      width: 20px;\n      background: var(--frc-bar-foreground, lightblue);\n      border-radius: 3px;\n    }\n  `;\n\n  constructor() {\n    super();\n\n    const resizeObserver = new ResizeObserver(() => {\n      this.resized();\n    });\n    resizeObserver.observe(this);\n  }\n\n  drawMotionVector(fl: number, fr: number, rl: number, rr: number) {\n    const svgNode = this.renderRoot.querySelector('#svg')!;\n    const rect = svgNode.getBoundingClientRect();\n\n    const wheelWidth = rect.width * 0.13;\n    const padding = 20;\n    const verticalPadding = 20;\n\n    const FRAME_WIDTH = rect.width - (wheelWidth + padding) * 2;\n    const FRAME_HEIGHT = rect.height - verticalPadding * 2;\n\n    const vectorRadius = Math.min(FRAME_WIDTH, FRAME_HEIGHT) / 2 - 16;\n    const direction = {\n      x: (fl - fr - rl + rr) / 4,\n      y: (fl + fr + rl + rr) / 4,\n    };\n    const moment = (-fl + fr - rl + rr) / 4;\n    const directionMagnitude = Math.hypot(direction.x, direction.y);\n    const directionAngle = Math.atan2(direction.y, direction.x);\n\n    // Barely moving, draw an X\n    if (Math.abs(moment) <= 0.01 && directionMagnitude <= 0.01) {\n      return generateX(rect.width * 0.2);\n    }\n\n    let rightMomentArrow = '';\n    let leftMomentArrow = '';\n    let directionArrow = '';\n\n    if (Math.abs(moment) > 0.01) {\n      // Only draw the moment vectors if the moment is significant enough\n      rightMomentArrow = CurvedArrow.createPolar(\n        0,\n        vectorRadius,\n        -moment * Math.PI,\n        0,\n        8\n      );\n      leftMomentArrow = CurvedArrow.createPolar(\n        Math.PI,\n        vectorRadius,\n        -moment * Math.PI,\n        0,\n        8\n      );\n    }\n    if (directionMagnitude > 0.01) {\n      // Only draw the direction vector if it'd be long enough\n      directionArrow = CurvedArrow.createStraight(\n        directionMagnitude * vectorRadius,\n        -directionAngle,\n        0,\n        8\n      );\n    }\n\n    return `<g class=\"arrow\">${rightMomentArrow} ${leftMomentArrow} ${directionArrow}</g>`;\n  }\n\n  drawDrivetrain() {\n    const svgNode = this.renderRoot.querySelector('#svg')!;\n    const rect = svgNode.getBoundingClientRect();\n\n    const wheelWidth = rect.width * 0.13;\n    const wheelRadius = Math.min(rect.width * 0.13, rect.height * 0.15);\n    const padding = 20;\n    const verticalPadding = 20;\n\n    const base = `\n      <rect \n        width=\"calc(100% - ${(wheelWidth + padding) * 2}px)\" \n        height=\"calc(100% - ${verticalPadding * 2}px)\"\n        x=\"${wheelWidth + padding}\" \n        y=\"20px\" \n      />\n    `;\n\n    const tlWheel = `\n      <rect \n        width=\"${wheelWidth}px\" \n        height=\"${wheelRadius * 2}\" \n        x=\"${padding}px\" \n        y=\"${verticalPadding}px\" \n      />\n    `;\n\n    const trWheel = `\n      <rect \n        width=\"${wheelWidth}px\" \n        height=\"${wheelRadius * 2}\" \n        x=\"calc(100% - ${wheelWidth + padding}px)\" \n        y=\"${verticalPadding}px\" \n      />\n    `;\n\n    const blWheel = `\n      <rect \n        width=\"${wheelWidth}px\" \n        height=\"${wheelRadius * 2}\" \n        x=\"${padding}px\"\n        y=\"calc(100% - ${wheelRadius * 2 + verticalPadding}px)\"\n      />\n    `;\n\n    const brWheel = `\n      <rect \n        width=\"${wheelWidth}px\" \n        height=\"${wheelRadius * 2}\" \n        x=\"calc(100% - ${wheelWidth + padding}px)\" \n        y=\"calc(100% - ${wheelRadius * 2 + verticalPadding}px)\"\n      />\n    `;\n\n    return base + tlWheel + trWheel + blWheel + brWheel;\n  }\n\n  getFlForegroundStyle() {\n    return getForegroundStyle(this.frontLeftMotorSpeed);\n  }\n\n  getFrForegroundStyle() {\n    return getForegroundStyle(this.frontRightMotorSpeed);\n  }\n\n  getRlForegroundStyle() {\n    return getForegroundStyle(this.rearLeftMotorSpeed);\n  }\n\n  getRrForegroundStyle() {\n    return getForegroundStyle(this.rearRightMotorSpeed);\n  }\n\n  firstUpdated() {\n    const drawing = this.drawMotionVector(0, 0, 0, 0);\n    this.renderRoot.querySelector('#drivetrain')!.innerHTML =\n      this.drawDrivetrain();\n    this.renderRoot.querySelector('#forceVector')!.innerHTML = drawing;\n  }\n\n  resized() {\n    const drawing = this.drawMotionVector(\n      clamp(this.frontLeftMotorSpeed),\n      clamp(this.frontRightMotorSpeed),\n      clamp(this.rearLeftMotorSpeed),\n      clamp(this.rearRightMotorSpeed)\n    );\n    this.renderRoot.querySelector('#forceVector')!.innerHTML = drawing;\n    const svgNode = this.renderRoot.querySelector('#svg')!;\n    const rect = svgNode.getBoundingClientRect();\n    (\n      this.renderRoot.querySelector('#forceVector')! as HTMLElement\n    ).style.transform = `translate(${rect.width * 0.5}px, ${\n      rect.height * 0.5\n    }px)`;\n    this.renderRoot.querySelector('#drivetrain')!.innerHTML =\n      this.drawDrivetrain();\n  }\n\n  updated(changedProps: Map<string, unknown>) {\n    super.updated(changedProps);\n    const drawing = this.drawMotionVector(\n      clamp(this.frontLeftMotorSpeed),\n      clamp(this.frontRightMotorSpeed),\n      clamp(this.rearLeftMotorSpeed),\n      clamp(this.rearRightMotorSpeed)\n    );\n    this.renderRoot.querySelector('#forceVector')!.innerHTML = drawing;\n  }\n\n  render() {\n    return html`\n      <div class=\"diff-drive-container\">\n        <div class=\"speed-pair\">\n          <div class=\"speed\">\n            <frc-table-axis\n              ticks=\"5\"\n              vertical\n              .range=\"${[1, -1]}\"\n            ></frc-table-axis>\n            <div class=\"bar\">\n              <div\n                class=\"foreground\"\n                style=\"${this.getFlForegroundStyle()}\"\n              ></div>\n            </div>\n          </div>\n          <div class=\"speed\">\n            <frc-table-axis\n              ticks=\"5\"\n              vertical\n              .range=\"${[1, -1]}\"\n            ></frc-table-axis>\n            <div class=\"bar\">\n              <div\n                class=\"foreground\"\n                style=\"${this.getRlForegroundStyle()}\"\n              ></div>\n            </div>\n          </div>\n        </div>\n        <svg id=\"svg\">\n          <g id=\"forceVector\"></g>\n          <g id=\"drivetrain\" class=\"drivetrain\"></g>\n        </svg>\n        <div class=\"speed-pair\">\n          <div class=\"speed\">\n            <frc-table-axis\n              ticks=\"5\"\n              vertical\n              .range=\"${[1, -1]}\"\n            ></frc-table-axis>\n            <div class=\"bar\">\n              <div\n                class=\"foreground\"\n                style=\"${this.getFrForegroundStyle()}\"\n              ></div>\n            </div>\n          </div>\n          <div class=\"speed\">\n            <frc-table-axis\n              ticks=\"5\"\n              vertical\n              .range=\"${[1, -1]}\"\n            ></frc-table-axis>\n            <div class=\"bar\">\n              <div\n                class=\"foreground\"\n                style=\"${this.getRrForegroundStyle()}\"\n              ></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n}\n\nif (!customElements.get('frc-mecanum-drivebase')) {\n  customElements.define('frc-mecanum-drivebase', MecanumDrivebase);\n}\n"],"names":["generateX","width","halfW","lineA","lineB","clamp","value","getForegroundStyle","val","MecanumDrivebase","LitElement","fl","fr","rl","rr","rect","wheelWidth","padding","verticalPadding","FRAME_WIDTH","FRAME_HEIGHT","vectorRadius","direction","moment","directionMagnitude","directionAngle","rightMomentArrow","leftMomentArrow","directionArrow","CurvedArrow.createPolar","CurvedArrow.createStraight","wheelRadius","base","tlWheel","trWheel","blWheel","brWheel","drawing","changedProps","html","css","__decorateClass","property"],"mappings":"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"}